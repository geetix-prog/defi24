---
import { allEquipes } from "../../backend/backend.mjs";
import Trophy from "../assets/trophy.svg"

const fullEquipes = await allEquipes();

const equipesMap = new Map();
fullEquipes.forEach(row => {
const equipeKey = row.equipe_nom;
if (!equipesMap.has(equipeKey)) {
    equipesMap.set(equipeKey, {
    id: row.id,
    nom: row.equipe_nom,
    logo: row.equipe_logo_url,
    description: row.description || '',
    points: row.points || 0,
    crea: row.crea || 0,
    coher: row.coher || 0,
    exec: row.exec || 0,
    presen: row.presen || 0,
    membres: []
    });
}
if (row.user_nom) {
    const equipe = equipesMap.get(equipeKey);
    const membreExiste = equipe.membres.some(m => m.nom === row.user_nom && m.prenom === row.user_prenom);
    if (!membreExiste) {
    equipe.membres.push({
        nom: row.user_nom,
        prenom: row.user_prenom
    });
    }
}
});

const equipes = Array.from(equipesMap.values())
.sort((a, b) => b.points - a.points);

const podiumConfigs = [
{ badge: 'bg-[#FFA500]', textColor: 'text-[#FFA500]', cardBg: 'bg-yellow/20' },
{ badge: 'bg-[#FF69B4]', textColor: 'text-[#FF69B4]', cardBg: 'bg-pink/20' },
{ badge: 'bg-[#6B46C1]', textColor: 'text-[#6B46C1]', cardBg: 'bg-primary/20' },
{ badge: 'bg-gray-700', textColor: 'text-gray-700', cardBg: 'bg-white' },
];
---
        
<div class="flex justify-center w-full items-center p-2 sm:p-3 md:p-4 h-full">
    <div class="bg-white rounded-3xl p-6 sm:p-8 md:p-10 shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] sm:shadow-[0_0_0_4px_black,6px_6px_0px_3px_black] w-full">
        <h2 class="font-oi text-2xl sm:text-3xl md:text-4xl lg:text-5xl uppercase text-clack text-center mb-6 sm:mb-8">
            Classement Complet
        </h2>
        
        <div class="space-y-3 sm:space-y-4">
        {equipes.map((equipe, index) => {
            const config = podiumConfigs[Math.min(index, 3)];
            
            return (
            <div class={`${config.cardBg} rounded-2xl sm:rounded-3xl p-4 sm:p-6 shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] mx-auto max-w-2xl`}>
                <div class="flex flex-col sm:flex-row items-center sm:items-center gap-4 sm:gap-6">
                    <div class={`${config.badge} w-12 h-12 sm:w-14 sm:h-14 rounded-full flex items-center justify-center shadow-[0_0_0_3px_black,3px_3px_0px_2px_black] flex-shrink-0`}>
                        <span class="text-white font-oi text-xl sm:text-2xl">{index + 1}</span>
                    </div>
                    
                    <div class="flex-1 min-w-0 text-center sm:text-left">
                        <h3 class="font-oi text-xl sm:text-2xl md:text-3xl text-black mb-1">
                            {equipe.nom}
                        </h3>
                        {equipe.description && (
                            <p class="font-nohemi text-xs sm:text-sm text-gray-700 mb-2">
                                {equipe.description}
                            </p>
                        )}
                        <div class="flex flex-wrap gap-1 sm:gap-2 text-xs sm:text-sm font-nohemi text-gray-600 justify-center sm:justify-start">
                            {equipe.membres.map((membre, i) => (
                                <span>
                                    {membre.prenom} {membre.nom}{i < equipe.membres.length - 1 ? ',' : ''}
                                </span>
                            ))}
                        </div>
                    </div>
                    
                    <div class="flex flex-col items-center gap-2 sm:gap-3">
                        <p class={`font-oi text-2xl sm:text-3xl ${config.textColor}`}>
                            {equipe.points}
                        </p>
                        <p class="font-nohemi text-xs text-gray-600">TOTAL</p>
                    </div>
                </div>
            </div>
            );
        })}
        
        {equipes.length === 0 && (
            <div class="text-center py-8 bg-white/20 rounded-2xl">
                <p class="font-nohemi text-white">Aucune Ã©quipe pour le moment</p>
            </div>
        )}
        </div>
    </div>
</div>
