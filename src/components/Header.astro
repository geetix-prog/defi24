---
import Button from "../components/Button.astro"
import Heures from "../assets/heures.astro"
---

<!-- Menu mobile (en dehors du header pour éviter les conflits de z-index) -->
<nav id="mobile-menu"
    class="fixed inset-0 bg-primary flex flex-col items-center justify-center gap-8 sm:gap-10 lg:hidden translate-x-full transition-transform duration-300 px-6 sm:px-8 z-40">
    <ul
        class="capitalize flex flex-col gap-5 sm:gap-7 md:gap-8 font-nohemi text-2xl xs:text-3xl sm:text-3xl md:text-4xl font-bold text-white text-center">
        <li><a href="/equipe" class="hover:scale-105 transition inline-block">Équipes</a></li>
        <li><a href="/classement" class="hover:scale-105 transition inline-block">Classement</a></li>
        <li><a href="/programme" class="hover:scale-105 transition inline-block">Programme</a></li>
        <li><a href="/creations" class="hover:scale-105 transition inline-block">Créations</a></li>
        <li><a href="/galerie" class="hover:scale-105 transition inline-block">Galerie</a></li>
        <li><a href="/contact" class="hover:scale-105 transition inline-block">Contact</a></li>
    </ul>

    <div class="flex flex-col gap-3 sm:gap-4 w-full px-4 sm:w-3/4 md:w-2/3 max-w-sm mt-16 sm:mt-20" id="auth-button-mobile">
        <Button bgClass="bg-tertiary" colorClass="text-white" text="Connexion" page="connexion"/>
    </div>
</nav>

<header
    class="w-[95%] md:w-[90%] lg:w-4/5 xl:w-3/5 rounded-full px-6 sm:px-6 md:px-8 py-4 sm:py-4 fixed top-3 lg:top-10 left-1/2 z-50 transition-all duration-300"
    style="transform: translateX(-50%);"
    id="main-header">
    <div id="header-bg" class="absolute inset-0 bg-white rounded-full border-2 md:border-3 border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] md:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-opacity duration-300"></div>
    <div class="flex items-center justify-between relative z-10">
        <a href="/" id="logo" class="font-oi flex flex-col -space-y-1 text-center leading-none relative shrink-0 transition-all hover:scale-110 duration-300 text-black">
            <span class="text-xl xs:text-2xl sm:text-3xl md:text-4xl">24</span>
            <Heures />
        </a>

        <button id="menu-btn" class="lg:hidden relative w-9 h-9 sm:w-10 sm:h-10 focus:outline-none shrink-0"
            aria-label="Toggle menu">
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
                <span class="block w-7 rounded-full sm:w-8 h-0.75 bg-black mb-1.5 sm:mb-2 transition-all duration-300"
                    id="line1"></span>
                <span class="block w-7 rounded-full sm:w-8 h-0.75 bg-black mb-1.5 sm:mb-2 transition-all duration-300"
                    id="line2"></span>
                <span class="block w-7 rounded-full sm:w-8 h-0.75 bg-black transition-all duration-300" id="line3"></span>
            </div>
        </button>

        <nav class="hidden lg:block flex-1 mx-8">
            <ul
                class="capitalize flex justify-center gap-4 xl:gap-6 2xl:gap-8 font-nohemi text-sm xl:text-base 2xl:text-lg font-bold">
                <li class="hover:scale-105 transition hover:text-primary ease-in whitespace-nowrap"><a
                        href="/equipe">équipes</a></li>
                <li class="hover:scale-105 transition hover:text-primary ease-in whitespace-nowrap"><a
                        href="/classement">classement</a></li>
                <li class="hover:scale-105 transition hover:text-primary ease-in whitespace-nowrap"><a
                        href="/programme">programme</a></li>
                <li class="hover:scale-105 transition hover:text-primary ease-in whitespace-nowrap"><a
                        href="/creations">créations</a></li>
                <li class="hover:scale-105 transition hover:text-primary ease-in whitespace-nowrap"><a
                        href="/galerie">galerie</a></li>
            </ul>
        </nav>

        <div class="hidden lg:block shrink-0" id="auth-button-desktop">
            <Button bgClass="bg-tertiary" colorClass="text-white" text="Connexion" page="connexion" />
        </div>
    </div>
</header>

<script>
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const line1 = document.getElementById('line1');
    const line2 = document.getElementById('line2');
    const line3 = document.getElementById('line3');
    const logo = document.getElementById('logo');
    const header = document.getElementById('main-header');
    const headerBg = document.getElementById('header-bg');

    // Toggle du menu mobile
    menuBtn?.addEventListener('click', () => {
        const isMenuOpen = !mobileMenu?.classList.contains('translate-x-full');
        
        if (isMenuOpen) {
            // Fermer le menu
            mobileMenu?.classList.add('translate-x-full');
            headerBg?.classList.remove('opacity-0');
            logo?.classList.remove('text-white');
            line1?.classList.remove('rotate-45', 'translate-y-[9px]', 'sm:translate-y-[11px]', 'bg-white');
            line2?.classList.remove('opacity-0');
            line3?.classList.remove('-rotate-45', '-translate-y-[9px]', 'sm:-translate-y-[11px]', 'bg-white');
            document.body.style.overflow = '';
        } else {
            // Ouvrir le menu
            mobileMenu?.classList.remove('translate-x-full');
            headerBg?.classList.add('opacity-0');
            logo?.classList.add('text-white');
            line1?.classList.add('rotate-45', 'translate-y-[9px]', 'sm:translate-y-[11px]', 'bg-white');
            line2?.classList.add('opacity-0');
            line3?.classList.add('-rotate-45', '-translate-y-[9px]', 'sm:-translate-y-[11px]', 'bg-white');
            document.body.style.overflow = 'hidden';
        }
    });

    // Fermer le menu lors du clic sur un lien
    const mobileLinks = document.querySelectorAll('#mobile-menu a');
    mobileLinks.forEach(link => {
        link.addEventListener('click', () => {
            mobileMenu?.classList.add('translate-x-full');
            headerBg?.classList.remove('opacity-0');
            logo?.classList.remove('text-white');
            line1?.classList.remove('rotate-45', 'translate-y-[9px]', 'sm:translate-y-[11px]', 'bg-white');
            line2?.classList.remove('opacity-0');
            line3?.classList.remove('-rotate-45', '-translate-y-[9px]', 'sm:-translate-y-[11px]', 'bg-white');
            document.body.style.overflow = '';
        });
    });

    const authButtonDesktop = document.getElementById('auth-button-desktop');
    const authButtonMobile = document.getElementById('auth-button-mobile');
    
    const userDataString = localStorage.getItem('user');
    
    if (userDataString && authButtonDesktop && authButtonMobile) {
        try {
            const userData = JSON.parse(userDataString);
            if (userData.email) {
                authButtonDesktop.innerHTML = `
                    <a 
                        href="/profile" 
                        class="inline-block bg-tertiary text-white px-6 sm:px-8 md:px-10 py-2 sm:py-2.5 md:py-3 rounded-full font-nohemi font-black text-base sm:text-lg shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] hover:scale-105 active:scale-95 transition-transform duration-150 ease-in text-center"
                    >
                        Mon Profil
                    </a>
                `;
                
                authButtonMobile.innerHTML = `
                    <a 
                        href="/profile" 
                        class="inline-block bg-tertiary text-white px-6 sm:px-8 md:px-10 py-2 sm:py-2.5 md:py-3 rounded-full font-nohemi font-black text-base sm:text-lg shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] hover:scale-105 active:scale-95 transition-transform duration-150 ease-in text-center"
                    >
                        Mon Profil
                    </a>
                `;
            }
        } catch (error) {
            console.error('Erreur lors de la lecture des données utilisateur', error);
        }
    }

    // Comportement du scroll pour desktop
    let lastScrollTop = 0;
    let scrollThreshold = 100; // Seuil de défilement avant de cacher/montrer
    
    function handleScroll() {
        // Ne pas appliquer sur mobile (< 1024px)
        if (window.innerWidth < 1024) {
            if (header) {
                header.style.transform = 'translateX(-50%) translateY(0)';
            }
            return;
        }

        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
        
        if (currentScroll > lastScrollTop && currentScroll > scrollThreshold) {
            // Scroll vers le bas - cacher le header
            if (header) {
                header.style.transform = 'translateX(-50%) translateY(-150%)';
            }
        } else if (currentScroll < lastScrollTop) {
            // Scroll vers le haut - montrer le header
            if (header) {
                header.style.transform = 'translateX(-50%) translateY(0)';
            }
        }
        
        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
    }

    // Ajouter l'écouteur de scroll
    window.addEventListener('scroll', handleScroll, { passive: true });
    
    // Réinitialiser au redimensionnement
    window.addEventListener('resize', () => {
        if (window.innerWidth < 1024 && header) {
            header.style.transform = 'translateX(-50%) translateY(0)';
        }
    });
</script>