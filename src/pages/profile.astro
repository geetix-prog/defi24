---
import Layout from "../layouts/Layout.astro";
---

<Layout>
    <div class="flex flex-col space-y-8 sm:space-y-10 md:space-y-15 justify-center items-center mt-16 sm:mt-20 md:mt-25 px-4 sm:px-6">
        <h1
            class="text-white font-oi text-center text-3xl xs:text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl leading-tight tracking-wide">
            Mon profil
        </h1>
        
        <p class="text-white font-nohemi text-center text-sm sm:text-base md:text-lg max-w-lg mb-6 sm:mb-8 md:mb-10">
            G√®re tes informations personnelles
        </p>
        
        <div class="bg-white/90 w-full max-w-2xl p-6 sm:p-8 md:p-10 rounded-2xl sm:rounded-3xl shadow-[0_0_0_2px_black,4px_4px_0px_1px_black] sm:shadow-[0_0_0_3px_black,6px_6px_0px_2px_black]">
            <div class="flex items-center gap-4 sm:gap-6 mb-6 sm:mb-8 pb-6 sm:pb-8 border-b-2 sm:border-b-3 border-gray-200">
                <div class="relative shrink-0">
                    <div id="userLogo" class="w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-gradient-to-br from-primary to-tertiary flex items-center justify-center text-white font-oi text-3xl sm:text-4xl border-2 sm:border-3 border-black shadow-[0_0_0_2px_black,3px_3px_0px_1px_black]">
                        ?
                    </div>
                </div>
                <div class="min-w-0 flex-1">
                    <h2 id="userName" class="font-oi text-black text-xl sm:text-2xl md:text-3xl mb-1 truncate">Chargement...</h2>
                    <p id="userEmail" class="font-nohemi text-gray-600 text-xs sm:text-sm truncate mb-2">email@example.com</p>
                    <span id="userRole" style="display: none;" class="px-3 py-1 rounded-full text-xs font-nohemi font-bold border-2 border-black"></span>
                </div>
            </div>

            <h3 class="font-nohemi text-primary text-lg sm:text-xl font-bold mb-3 sm:mb-4">Informations</h3>

            <form id="profileForm" class="space-y-4 sm:space-y-5">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="prenom" class="block font-nohemi text-black font-bold mb-2 text-sm sm:text-base">Pr√©nom</label>
                        <input 
                            type="text" 
                            name="prenom" 
                            id="prenom" 
                            required 
                            placeholder="Jean"
                            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border-2 sm:border-3 border-black rounded-xl sm:rounded-2xl font-nohemi text-sm sm:text-base focus:outline-none focus:ring-2 sm:focus:ring-3 focus:ring-primary transition-all"
                        />
                    </div>
                    <div>
                        <label for="nom" class="block font-nohemi text-black font-bold mb-2 text-sm sm:text-base">Nom</label>
                        <input 
                            type="text" 
                            name="nom" 
                            id="nom" 
                            required 
                            placeholder="Dupont"
                            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border-2 sm:border-3 border-black rounded-xl sm:rounded-2xl font-nohemi text-sm sm:text-base focus:outline-none focus:ring-2 sm:focus:ring-3 focus:ring-primary transition-all"
                        />
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="email" class="block font-nohemi text-black font-bold mb-2 text-sm sm:text-base">Email</label>
                        <input 
                            type="email" 
                            name="email" 
                            id="email" 
                            required 
                            placeholder="ton-email@example.com"
                            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border-2 sm:border-3 border-black rounded-xl sm:rounded-2xl font-nohemi text-sm sm:text-base focus:outline-none focus:ring-2 sm:focus:ring-3 focus:ring-primary transition-all"
                        />
                    </div>
                    <div>
                        <label for="promo" class="block font-nohemi text-black font-bold mb-2 text-sm sm:text-base">Ann√©e de promotion</label>
                        <select 
                            name="promo" 
                            id="promo" 
                            required
                            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border-2 sm:border-3 border-black rounded-xl sm:rounded-2xl font-nohemi text-sm sm:text-base focus:outline-none focus:ring-2 sm:focus:ring-3 focus:ring-primary transition-all bg-white cursor-pointer"
                        >
                            <option value="" disabled selected>- Select -</option>
                            <option value="2025-2028">2025-2028</option>
                            <option value="2024-2027">2024-2027</option>
                            <option value="2023-2026">2023-2026</option>
                            <option value="ancien">Ancien</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label for="equipe" class="block font-nohemi text-black font-bold mb-2 text-sm sm:text-base">√âquipe</label>
                    <div class="flex gap-2">
                        <input 
                            type="text" 
                            name="equipe" 
                            id="equipe" 
                            readonly
                            placeholder="Aucune √©quipe"
                            class="flex-1 px-3 sm:px-4 py-2.5 sm:py-3 border-2 sm:border-3 border-black rounded-xl sm:rounded-2xl font-nohemi text-sm sm:text-base bg-gray-100 cursor-not-allowed"
                        />
                        <button
                            type="button"
                            id="editEquipeBtn"
                            style="display: none;"
                            class="px-3 sm:px-4 py-2.5 sm:py-3 border-2 sm:border-3 border-black rounded-xl sm:rounded-2xl bg-primary text-white font-nohemi font-bold text-sm hover:scale-105 active:scale-95 transition-transform"
                        >
                            ‚úèÔ∏è
                        </button>
                    </div>
                    <p id="equipeId" class="font-mono text-primary text-xs mt-1 px-1"></p>
                    <p id="equipeMessage" class="text-xs mt-1 px-1 font-nohemi font-bold"></p>
                </div>

                <div>
                    <label for="confirmPassword" class="block font-nohemi text-black font-bold mb-2 text-sm sm:text-base">Mot de passe de confirmation</label>
                    <div class="relative">
                        <input 
                            type="password" 
                            name="confirmPassword" 
                            id="confirmPassword" 
                            required
                            placeholder="Entrez votre mot de passe pour confirmer"
                            class="w-full px-4 sm:px-5 py-2.5 sm:py-3.5 border-2 sm:border-3 border-black rounded-xl sm:rounded-2xl font-nohemi text-sm sm:text-base focus:outline-none focus:ring-2 sm:focus:ring-3 focus:ring-primary transition-all pr-11 sm:pr-12"
                        />
                        <button 
                            type="button" 
                            id="toggleConfirmPassword"
                            class="absolute right-3 sm:right-4 top-1/2 -translate-y-1/2 text-gray-600 hover:text-black transition"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 sm:w-5 sm:h-5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </button>
                    </div>
                    <p class="text-xs text-gray-600 font-nohemi mt-1">Requis pour valider les modifications</p>
                </div>

                <button 
                    type="submit"
                    class="inline-block w-full bg-primary text-white px-6 sm:px-8 md:px-10 py-2.5 sm:py-3 rounded-full font-nohemi font-black text-sm sm:text-base md:text-lg shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] hover:scale-105 active:scale-95 transition-transform duration-150 ease-in text-center"
                >
                    Modifier mes informations
                </button>

                <div id="message" class="text-center font-nohemi font-bold mt-4 text-sm sm:text-base"></div>
            </form>

            <div class="mt-6 pt-6 border-t-3 border-gray-200">
                <button 
                    id="logoutBtn"
                    class="inline-block w-full bg-red-500 text-white px-6 sm:px-8 md:px-10 py-2.5 sm:py-3 rounded-full font-nohemi font-black text-sm sm:text-base md:text-lg shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] hover:scale-105 active:scale-95 transition-transform duration-150 ease-in text-center"
                >
                    Se d√©connecter
                </button>
            </div>

            <div id="teamSection" class="mt-8 sm:mt-10 p-4 sm:p-6 bg-pink-100 rounded-xl sm:rounded-2xl border-2 sm:border-3 border-black hidden">
                <h3 class="font-oi text-black text-xl sm:text-2xl mb-2 sm:mb-3">Ton √©quipe</h3>
                <p class="font-nohemi text-black text-xs sm:text-sm mb-3 sm:mb-4">
                    Retrouve les membres de ton √©quipe. C'est le chef d'√©quipe qui a le droit de rendre le projet final que toute l'√©quipe, en attendant, donne tout ce que tu as !
                </p>

                <div class="bg-white p-3 sm:p-4 rounded-xl sm:rounded-2xl border-2 sm:border-3 border-black mb-3 sm:mb-4">
                    <div class="flex items-center gap-2 sm:gap-3 mb-3">
                        <div id="teamLogoContainer" class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-primary to-tertiary flex items-center justify-center text-white font-oi text-lg sm:text-xl border-2 border-black shrink-0">
                            TR
                        </div>
                        <div class="min-w-0 flex-1">
                            <h4 id="teamName" class="font-oi text-black text-lg sm:text-xl truncate">La team rose</h4>
                            <p id="teamMemberCount" class="font-nohemi text-gray-600 text-xs sm:text-sm">5 membres</p>
                            <p id="teamId" class="font-nohemi text-gray-500 text-xs truncate mt-1"></p>
                        </div>
                    </div>

                    <h5 class="font-nohemi text-primary font-bold mb-2 sm:mb-3 text-sm sm:text-base">Membres de l'√©quipe</h5>
                    <div id="teamMembers" class="space-y-2">
                    </div>
                </div>

                <p class="text-center font-nohemi text-xs text-gray-600 mb-4">
                    Le chef d'√©quipe <span id="chefName" class="font-bold text-primary">Chef</span> doit faire le rendu pour toute l'√©quipe
                </p>

                <button 
                    id="leaveTeamBtn"
                    style="display: none;"
                    class="w-full bg-red-500 text-white px-4 sm:px-6 py-2 sm:py-2.5 rounded-full font-nohemi font-bold text-sm sm:text-base shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] hover:scale-105 active:scale-95 transition-transform"
                >
                    Quitter l'√©quipe
                </button>
                <p id="leaveTeamMessage" class="text-center font-nohemi font-bold text-xs sm:text-sm mt-2"></p>
            </div>
        </div>
    </div>
</Layout>
<script>
    const userDataString = localStorage.getItem('user');
    if (!userDataString) {
        window.location.href = '/connexion';
    } else {
        const userData = JSON.parse(userDataString);
        loadProfile(userData.id);
    }

    async function loadProfile(userId: string) {
        try {
            const response = await fetch(`/apis/get-profile?userId=${userId}`);
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Erreur lors du chargement du profil');
            }

            const user = data.user;
            const equipe = data.equipe;

            document.getElementById('userName')!.textContent = `${user.prenom} ${user.nom}`;
            document.getElementById('userEmail')!.textContent = user.email;
            (document.getElementById('prenom') as HTMLInputElement).value = user.prenom || '';
            (document.getElementById('nom') as HTMLInputElement).value = user.nom || '';
            (document.getElementById('email') as HTMLInputElement).value = user.email || '';
            (document.getElementById('promo') as HTMLSelectElement).value = user.promo || '';

            const avatarContainer = document.getElementById('userLogo');
            if (avatarContainer) {
                if (user.avatar_url) {
                    avatarContainer.innerHTML = `
                        <div class="w-20 h-20 sm:w-24 sm:h-24 rounded-full border-2 sm:border-3 border-black shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] overflow-hidden">
                            <img src="${user.avatar_url}" alt="Avatar" class="w-full h-full object-cover" />
                        </div>
                    `;
                } else {
                    const initials = `${user.prenom?.charAt(0) || ''}${user.nom?.charAt(0) || ''}`.toUpperCase();
                    avatarContainer.innerHTML = `
                        <div class="w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-gradient-to-br from-primary to-tertiary flex items-center justify-center text-white font-oi text-3xl sm:text-4xl border-2 sm:border-3 border-black shadow-[0_0_0_2px_black,3px_3px_0px_1px_black]">
                            ${initials}
                        </div>
                    `;
                }
            }

            const equipeInput = document.getElementById('equipe') as HTMLInputElement;
            const editEquipeBtn = document.getElementById('editEquipeBtn');
            
            equipeInput.value = equipe?.nom || 'Aucune √©quipe';
            
            const equipeIdElement = document.getElementById('equipeId');
            if (equipeIdElement) {
                if (equipe?.equipe_id) {
                    equipeIdElement.textContent = `Code: ${equipe.equipe_id}`;
                } else {
                    equipeIdElement.textContent = '';
                }
            }

            // Si l'utilisateur est chef, permettre l'√©dition du nom de l'√©quipe
            if (equipe && equipe.chef === userId) {
                if (editEquipeBtn) {
                    editEquipeBtn.style.display = 'block';
                    
                    let isEditing = false;
                    editEquipeBtn.addEventListener('click', async () => {
                        if (!isEditing) {
                            // Mode √©dition
                            isEditing = true;
                            equipeInput.readOnly = false;
                            equipeInput.classList.remove('bg-gray-100', 'cursor-not-allowed');
                            equipeInput.classList.add('bg-white');
                            equipeInput.focus();
                            editEquipeBtn.textContent = 'üíæ';
                            editEquipeBtn.classList.remove('bg-primary');
                            editEquipeBtn.classList.add('bg-green-500');
                        } else {
                            // Sauvegarder
                            const nouveauNom = equipeInput.value.trim();
                            if (!nouveauNom) {
                                const equipeMessage = document.getElementById('equipeMessage');
                                if (equipeMessage) {
                                    equipeMessage.textContent = 'Le nom ne peut pas √™tre vide';
                                    equipeMessage.style.color = 'red';
                                    setTimeout(() => equipeMessage.textContent = '', 3000);
                                }
                                return;
                            }

                            try {
                                const formData = new FormData();
                                formData.append('userId', userId);
                                formData.append('equipeId', equipe.equipe_id);
                                formData.append('nom', nouveauNom);

                                const response = await fetch('/apis/update-equipe', {
                                    method: 'POST',
                                    body: formData
                                });

                                const data = await response.json();

                                const equipeMessage = document.getElementById('equipeMessage');
                                if (response.ok) {
                                    if (equipeMessage) {
                                        equipeMessage.textContent = '‚úì Nom mis √† jour avec succ√®s';
                                        equipeMessage.style.color = 'green';
                                        setTimeout(() => equipeMessage.textContent = '', 3000);
                                    }
                                    
                                    isEditing = false;
                                    equipeInput.readOnly = true;
                                    equipeInput.classList.add('bg-gray-100', 'cursor-not-allowed');
                                    equipeInput.classList.remove('bg-white');
                                    editEquipeBtn.textContent = '‚úèÔ∏è';
                                    editEquipeBtn.classList.add('bg-primary');
                                    editEquipeBtn.classList.remove('bg-green-500');
                                    
                                    // Recharger pour mettre √† jour toute la page
                                    setTimeout(() => window.location.reload(), 1500);
                                } else {
                                    if (equipeMessage) {
                                        equipeMessage.textContent = data.error || 'Erreur lors de la mise √† jour';
                                        equipeMessage.style.color = 'red';
                                        setTimeout(() => equipeMessage.textContent = '', 3000);
                                    }
                                }
                            } catch (error) {
                                const equipeMessage = document.getElementById('equipeMessage');
                                if (equipeMessage) {
                                    equipeMessage.textContent = 'Erreur de connexion';
                                    equipeMessage.style.color = 'red';
                                    setTimeout(() => equipeMessage.textContent = '', 3000);
                                }
                            }
                        }
                    });
                }
            }

            // Afficher le badge de r√¥le
            const userRoleElement = document.getElementById('userRole');
            if (userRoleElement && equipe) {
                if (equipe.chef === userId) {
                    userRoleElement.textContent = 'üëë Chef d\'√©quipe';
                    userRoleElement.className = 'inline-block px-3 py-1 rounded-full text-xs font-nohemi font-bold border-2 border-black bg-primary text-white';
                } else {
                    userRoleElement.textContent = 'üë§ Membre';
                    userRoleElement.className = 'inline-block px-3 py-1 rounded-full text-xs font-nohemi font-bold border-2 border-black bg-tertiary text-white';
                }
                userRoleElement.style.display = 'inline-block';
            }

            if (equipe) {
                const teamSection = document.getElementById('teamSection');
                if (teamSection) {
                    teamSection.classList.remove('hidden');
                    document.getElementById('teamName')!.textContent = equipe.nom;
                    document.getElementById('teamId')!.textContent = `Code: ${equipe.equipe_id}`;
                    document.getElementById('teamMemberCount')!.textContent = `${equipe.usersDetails.length} membre${equipe.usersDetails.length > 1 ? 's' : ''}`;

                    const teamLogoContainer = document.getElementById('teamLogoContainer');
                    if (teamLogoContainer) {
                        if (equipe.logo_url) {
                            teamLogoContainer.innerHTML = `<img src="${equipe.logo_url}" alt="Logo" class="w-full h-full object-cover rounded-full">`;
                        } else {
                            const initials = equipe.nom.split(' ').map((word: string) => word.charAt(0)).join('').toUpperCase().slice(0, 2);
                            teamLogoContainer.textContent = initials;
                        }
                    }

                    const chefUser = equipe.usersDetails.find((u: any) => u.id === equipe.chef);
                    if (chefUser) {
                        document.getElementById('chefName')!.textContent = `${chefUser.prenom} ${chefUser.nom}`;
                    }

                    const teamMembers = document.getElementById('teamMembers');
                    if (teamMembers) {
                        teamMembers.innerHTML = '';
                        equipe.usersDetails.forEach((membre: any) => {
                            const isChef = membre.id === equipe.chef;
                            const memberDiv = document.createElement('div');
                            memberDiv.className = 'flex items-center justify-between p-2.5 sm:p-3 bg-white rounded-xl border-2 border-black';

                            let avatarHtml = '';
                            if (membre.avatar_url) {
                                avatarHtml = `<img src="${membre.avatar_url}" alt="Avatar" class="w-full h-full object-cover rounded-full">`;
                            } else {
                                const initials = `${membre.prenom?.charAt(0) || ''}${membre.nom?.charAt(0) || ''}`.toUpperCase();
                                avatarHtml = initials;
                            }

                            memberDiv.innerHTML = `
                                <div class="flex items-center gap-2 sm:gap-3 min-w-0 flex-1">
                                    <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gradient-to-br from-primary to-tertiary flex items-center justify-center text-white font-oi text-xs sm:text-sm border-2 border-black shrink-0">
                                        ${avatarHtml}
                                    </div>
                                    <div class="font-nohemi text-black text-sm sm:text-base truncate">
                                        ${membre.prenom} ${membre.nom}
                                    </div>
                                </div>
                                ${isChef ? '<span class="bg-tertiary text-white px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-xs font-nohemi font-bold shrink-0">Chef</span>' : ''}
                            `;
                            teamMembers.appendChild(memberDiv);
                        });
                    }

                    // Afficher le bouton "Quitter l'√©quipe" si l'utilisateur n'est pas le chef
                    const leaveTeamBtn = document.getElementById('leaveTeamBtn');
                    if (leaveTeamBtn && equipe.chef !== userId) {
                        leaveTeamBtn.style.display = 'block';
                    }
                }
            }

        } catch (error) {
            console.error('Erreur:', error);
        }
    }

    const profileForm = document.getElementById('profileForm') as HTMLFormElement;
    const messageDiv = document.getElementById('message') as HTMLDivElement;

    profileForm?.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const prenomInput = document.getElementById('prenom') as HTMLInputElement;
        const nomInput = document.getElementById('nom') as HTMLInputElement;
        const emailInput = document.getElementById('email') as HTMLInputElement;
        const promoInput = document.getElementById('promo') as HTMLSelectElement;
        const confirmPasswordInput = document.getElementById('confirmPassword') as HTMLInputElement;
        
        messageDiv.textContent = '';

        try {
            const userData = JSON.parse(localStorage.getItem('user') || '{}');
            
            const formData = new FormData();
            formData.append('userId', userData.id);
            formData.append('prenom', prenomInput.value);
            formData.append('nom', nomInput.value);
            formData.append('email', emailInput.value);
            formData.append('promo', promoInput.value);
            formData.append('confirmPassword', confirmPasswordInput.value);

            const response = await fetch('/apis/update-profile', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('user', JSON.stringify(data.user));
                
                messageDiv.textContent = data.message;
                messageDiv.style.color = 'green';
                
                confirmPasswordInput.value = '';
                
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            } else {
                messageDiv.textContent = data.error || 'Erreur lors de la mise √† jour';
                messageDiv.style.color = 'red';
            }

        } catch (error) {
            messageDiv.textContent = 'Erreur de connexion au serveur';
            messageDiv.style.color = 'red';
            console.error(error);
        }
    });

    const toggleConfirmPasswordBtn = document.getElementById('toggleConfirmPassword');
    const confirmPasswordInput = document.getElementById('confirmPassword') as HTMLInputElement;

    toggleConfirmPasswordBtn?.addEventListener('click', () => {
        if (confirmPasswordInput.type === 'password') {
            confirmPasswordInput.type = 'text';
        } else {
            confirmPasswordInput.type = 'password';
        }
    });

    const logoutBtn = document.getElementById('logoutBtn');
    
    logoutBtn?.addEventListener('click', () => {
        logoutBtn.textContent = 'D√©connexion en cours...';
        logoutBtn.style.backgroundColor = '#ef4444';
        
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        
        logoutBtn.textContent = '‚úì D√©connect√© avec succ√®s';
        logoutBtn.style.backgroundColor = '#22c55e';
        
        setTimeout(() => {
            window.location.href = '/';
        }, 1000);
    });

    // G√©rer le bouton "Quitter l'√©quipe"
    const leaveTeamBtn = document.getElementById('leaveTeamBtn') as HTMLButtonElement;
    const leaveTeamMessage = document.getElementById('leaveTeamMessage');

    leaveTeamBtn?.addEventListener('click', async () => {
        // Demander confirmation
        if (!confirm('√ätes-vous s√ªr de vouloir quitter cette √©quipe ?')) {
            return;
        }

        const userDataString = localStorage.getItem('user');
        if (!userDataString) {
            if (leaveTeamMessage) {
                leaveTeamMessage.textContent = 'Erreur : utilisateur non connect√©';
                leaveTeamMessage.style.color = 'red';
            }
            return;
        }

        const userData = JSON.parse(userDataString);
        const userId = userData.id;

        leaveTeamBtn.textContent = 'D√©part en cours...';
        leaveTeamBtn.disabled = true;

        try {
            const formData = new FormData();
            formData.append('userId', userId);

            const response = await fetch('/apis/leave-equipe', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (response.ok) {
                if (leaveTeamMessage) {
                    leaveTeamMessage.textContent = '‚úì ' + data.message;
                    leaveTeamMessage.style.color = 'green';
                }

                // Recharger la page apr√®s 1.5 secondes
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            } else {
                if (leaveTeamMessage) {
                    leaveTeamMessage.textContent = data.error || 'Erreur lors du d√©part de l\'√©quipe';
                    leaveTeamMessage.style.color = 'red';
                }
                leaveTeamBtn.textContent = 'Quitter l\'√©quipe';
                leaveTeamBtn.disabled = false;
            }
        } catch (error) {
            if (leaveTeamMessage) {
                leaveTeamMessage.textContent = 'Erreur de connexion au serveur';
                leaveTeamMessage.style.color = 'red';
            }
            leaveTeamBtn.textContent = 'Quitter l\'√©quipe';
            leaveTeamBtn.disabled = false;
            console.error(error);
        }
    });
</script>