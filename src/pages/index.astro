---
import Layout from "../layouts/Layout.astro";
import Decompte from "../components/decompte.astro";
import Tag from "../components/Tag.astro";
import Button from "../components/Button.astro";
import Marquee from "../components/Banniere.astro";
import Classement from "../components/Classement.astro";
import Programme from "../components/Programme.astro";
import Defisbonus from "../components/Defisbonus.astro";
import Decomptesimple from "../components/decomptesimple.astro";
import Trophy from "../assets/trophy.svg";
import Palette from "../assets/palette.svg";
import Equipe from "../assets/equipe.svg";
import Participant from "../assets/participant.svg";
import { getallPartenaires, stats, allEquipes, countDepots } from "../../backend/backend.mjs";
const partenaires = await getallPartenaires();
const statsData = await stats();
const totalRendus = await countDepots();

// R√©cup√©ration des √©quipes et regroupement par √©quipe
const equipesData = await allEquipes();
const equipesGrouped = equipesData.reduce((acc: any, row: any) => {
	if (!acc[row.equipe_nom]) {
		acc[row.equipe_nom] = {
			equipe_nom: row.equipe_nom,
			equipe_logo_url: row.equipe_logo_url,
			points: row.points || 0,
			description: row.description || '',
			membres: []
		};
	}
	acc[row.equipe_nom].membres.push({
		user_nom: row.user_nom,
		user_prenom: row.user_prenom,
		user_avatar_url: row.user_avatar_url,
		user_email: row.user_email
	});
	return acc;
}, {});

// Tri des √©quipes par points et r√©cup√©ration du top 3
const topEquipes = (Object.values(equipesGrouped) as any[])
	.sort((a, b) => b.points - a.points)
	.slice(0, 3);
---


<!--
<Layout 
	title="D√©fi 24h - L'√©v√©nement incontournable du cursus MMI | 09 janvier 2026"
	description="Participez au D√©fi 24H le 09 janvier 2026 ! 24 heures non-stop pour cr√©er, imaginer et repousser vos limites sur un th√®me surprise. Design, d√©veloppement, montage : tout le monde a sa place !"
	keywords="d√©fi 24h, MMI, cr√©ation, design, d√©veloppement, √©v√©nement √©tudiant, challenge cr√©atif, 24 heures, concours cr√©atif, inscription, 09 janvier 2026"
	canonical="/"
>
	<div class="flex flex-col space-y-15 justify-center items-center mt-25 lg:mt-40 px-4">
		<h1
			class="text-white font-oi text-center text-5xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl leading-tight sm:leading-tight md:leading-normal tracking-wide">
			Le d√©fi 24H <br>C'est bient√¥t !
		</h1>
		<div class="flex flex-col space-y-7">
			<Tag bgClass="bg-tertiary" colorClass="text-white" text="09 JANVIER 2026" />
			<div class="text-center px-10">
				<a id="inscriptionBtn" href="/inscription" class="inline-block bg-white text-primary px-6 sm:px-8 md:px-10 py-2 sm:py-2.5 md:py-3 rounded-full font-nohemi font-black text-base sm:text-lg shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] hover:scale-105 active:scale-95 transition-transform duration-150 ease-in text-center cursor-pointer">
					Inscription
				</a>
			</div> 
		</div>
	</div>
	<div class="mt-25">
		<Marquee />
	</div>
	<div class="flex flex-col items-center mt-25 space-y-15">
		<div class="space-y-5 flex flex-col items-center">
			<div
				class="inline-block space-y-2 lg:space-y-5 bg-white/80 w-8/10 px-6 sm:px-8 md:px-10 py-7 md:py-10 lg:py-15 rounded-2xl font-nohemi shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black]">
				<h2 class="font-oi uppercase text-primary text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl">24
					heures</h2>
				<p
					class="font-nohemi text-tertiary text-xl sm:text-2xl md:text-2xl lg:text-3xl xl:text-3xl font-normal">
					Pour cr√©er, rire... et ne pas dormir !</p>
			</div>
			<div class="w-8/10 flex flex-col lg:flex-row gap-5 lg:items-stretch">
				<div
					class="space-y-2 lg:space-y-5 w-full bg-white/80 px-6 sm:px-8 md:px-10 py-7 md:py-10 lg:py-15 rounded-2xl shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black]">
				<p class="font-nohemi text-black text-sm sm:text-base md:text-lg font-normal">
					Le D√©fi 24H, c'est l'√©v√©nement incontournable du cursus MMI : 24 heures non-stop pour cr√©er,
					imaginer et repousser vos limites sur un th√®me surprise. Que vous soyez fan de design, de
					montage,
					de d√©veloppement ou juste l√† pour l'ambiance (et les pizzas), tout le monde a sa place !</p>
				</div>
				<div
					class="space-y-2 lg:space-y-5 w-full bg-gradient-to-b from-[#FFC567] to-[#FD5A46] px-6 sm:px-8 md:px-10 py-7 md:py-10 lg:py-15 rounded-2xl shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] flex justify-center items-center">
					<p class="font-nohemi text-white text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl">Pr√™t √† relever le challenge ?
					</p>
				</div>
			</div>
			<div
				class="inline-block space-y-2 lg:space-y-5 bg-white/80 w-8/10 px-6 sm:px-8 md:px-10 py-7 md:py-10 lg:py-15 rounded-2xl font-nohemi shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black]">
				<p class="font-nohemi text-black text-sm sm:text-base md:text-lg font-normal">
					Au D√©fi 24H, on joue en √©quipe ! Regroupe 4 ou 5 g√©nies cr√©atifs (ou juste tes potes, √ßa marche aussi) et pr√©pare-toi √† vivre une aventure intense.
				</p>
			</div>
		</div>
	</div>
		<div class="flex justify-center w-full mt-20">
			<Button bgClass="bg-white" colorClass="text-primary" text="Former mon √©quipe" page="equipe" />
		</div>
	<div class="mt-25 flex flex-col mx-auto w-8/10 space-y-5 lg:space-y-10">
		<div
			class="inline-block space-y-2 lg:space-y-5 bg-lightprimary w-full px-6 sm:px-8 md:px-10 py-7 md:py-10 lg:py-15 rounded-2xl font-nohemi shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black]">
			<h2 class="font-oi uppercase text-white text-2xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl">Nos<br>partenaires</h2>
		</div>
		<div class="flex flex-col lg:grid lg:grid-cols-4 gap-5 w-full">
			{partenaires.map((partenaire) => (
			<a href={partenaire.lien} class="space-y-2 hover:-translate-y-2 transition-all ease-in lg:space-y-5 bg-white w-full px-6 sm:px-8 md:px-10 py-7 md:py-10 lg:py-15 rounded-2xl font-nohemi shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] flex flex-col justify-center items-center">
				<img src={partenaire.img} alt={partenaire.nom} class="max-h-24 sm:max-h-28 md:max-h-32 lg:max-h-36 object-contain" />
				<p>{partenaire.nom}</p>
			</a>
			))}
		</div>
	</div>
	<div class="space-y-2 lg:space-y-5 bg-white/80 w-8/10 lg:w-5/10 px-6 sm:px-8 md:px-10 py-7 md:py-10 lg:py-15 rounded-2xl font-nohemi shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] flex flex-col items-center mx-auto mt-25">
		<p class="font-nohemi text-primary text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl">Une question ? Besoin d'infos ?</p>
		<h2 class="font-oi uppercase text-tertiary text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl text-center">Contactez-nous !</h2>
		<Button bgClass="bg-primary" colorClass="text-white" text="Envoyer un message" page="contact" />
	</div>
</Layout>

<Layout
	title="D√©fi 24h - L'√©v√©nement incontournable du cursus MMI | 09 janvier 2026"
	description="Participez au D√©fi 24H le 09 janvier 2026 ! 24 heures non-stop pour cr√©er, imaginer et repousser vos limites sur un th√®me surprise. Design, d√©veloppement, montage : tout le monde a sa place !"
	keywords="d√©fi 24h, MMI, cr√©ation, design, d√©veloppement, √©v√©nement √©tudiant, challenge cr√©atif, 24 heures, concours cr√©atif, inscription, 09 janvier 2026"
	canonical="/"
	bgColor="var(--color-tertiary)"
>
	<div class="flex flex-col space-y-8 justify-center items-center mt-25 lg:mt-40 px-4">
		<div
			class="inline-block bg-white px-3 sm:px-4 md:px-5 py-1 sm:py-1.5 md:py-2 rounded-xl font-nohemi font-black text-xs sm:text-sm lg:text-base shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] text-center"
			>
			<p class="uppercase">
				üî¥ En direct
			</p>
		</div>	
		<h1
			class="text-white font-oi text-center text-5xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl leading-tight sm:leading-tight md:leading-normal tracking-wide">
			C‚Äôest parti!
		</h1>
		<p class="font-nohemi text-white text-xs sm:text-sm md:text-base lg:text-lg">Rien n'est √©crit tant que tout n'est pas invent√©</p>
		<p class="font-nohemi text-white text-xs sm:text-sm md:text-base lg:text-lg">Tent√© de remporter un lot ?</p>
		<Decompte />
		<div class="flex flex-col xl:flex-row w-full max-w-[1600px] gap-3 sm:gap-4 md:gap-5 xl:items-stretch">
			<div class="flex-1">
				<Classement />
			</div>
			<div class="flex-1">
				<Programme />
			</div>
		</div>
		<div class="w-8/10">
			<Defisbonus />
		</div>

		<div class="flex flex-col gap-4 sm:gap-5 w-8/10 mt-8 sm:mt-10">
			<div class="bg-gradient-to-r from-orange-400 to-orange-500 rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] flex flex-col items-center text-center">
				<div class="w-10 h-10 sm:w-12 sm:h-12 mb-3 sm:mb-4">
					<svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
					</svg>
				</div>
				<p class="font-nohemi text-white text-xl sm:text-2xl md:text-3xl uppercase leading-tight">"Rien n'est √©crit tant que tout n'est pas invent√©"</p>
			</div>

			<div class="bg-gradient-to-br from-purple-500 via-pink-500 to-pink-400 rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] flex flex-col items-center text-center">
				<h3 class="font-oi text-white text-2xl sm:text-3xl md:text-4xl uppercase mb-2 sm:mb-3">Besoin d'aide ?</h3>
				<p class="font-nohemi text-white text-sm sm:text-base md:text-lg">Les mentors sont l√† pour vous ! Rendez-vous au stand d'assistance.</p>
			</div>
		</div>

</Layout>-->

<Layout
	title="R√©sultats - D√©fi 24h MMI"
	description="D√©couvrez les r√©sultats du D√©fi 24h MMI et le podium des √©quipes gagnantes !"
	keywords="r√©sultats d√©fi 24h, podium, gagnants, MMI"
	canonical="/"
	bgColor="linear-gradient(135deg, #D946EF 0%, #6366F1 50%, #3B82F6 100%)"
>
	<div class="flex flex-col space-y-8 justify-center items-center mt-25 lg:mt-40 px-4">
		<div class="flex items-center bg-white px-3 sm:px-4 md:px-5 py-1 sm:py-1.5 md:py-2 rounded-xl font-nohemi font-black text-xs sm:text-sm lg:text-base shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] text-center">
			<Trophy class="inline-block w-5 h-5 mr-2 -mt-1" />
			<p class="uppercase">
				TERMIN√â
			</p>
		</div>

		<div class="flex flex-col items-center font-nohemi">
			<h1 class="text-white font-oi text-center text-6xl sm:text-7xl md:text-8xl lg:text-9xl xl:text-[10rem] leading-tight sm:leading-tight md:leading-normal tracking-wide uppercase">
				D√âFI 24H
			</h1>
			<p class="font-nohemi text-white text-sm sm:text-base md:text-lg lg:text-xl xl:text-2xl">
				24 heures de cr√©ativit√© intense - Mission accomplie ! üéâ
			</p>
		</div>

		<div class="w-8/10 max-w-7xl">
			<div class="bg-white/95 rounded-3xl p-6 sm:p-8 md:p-12 lg:p-16 shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] sm:shadow-[0_0_0_4px_black,6px_6px_0px_3px_black]">
				<div class="text-center mb-8 sm:mb-10 lg:mb-12">
			<div class="text-5xl sm:text-6xl mb-3 sm:mb-4">
				üèÜ
			</div>
			<h2 class="font-oi text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 uppercase">
				Le Podium
			</h2>
			<p class="font-nohemi text-base sm:text-lg text-gray-700">
				Bravo aux gagnants ! üèÜ
			</p>
		</div>

		<div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-5 md:gap-6 mb-8 sm:mb-10 lg:mb-12">
		{[1, 0, 2].map((position) => {
			const equipe = topEquipes[position];
			if (!equipe) return null;
			
			const podiumConfigs = [
				{ bg: 'bg-[#FFF8E7]', badge: 'bg-[#FFA500]', icon: 'üèÜ', textColor: 'text-[#FFA500]', border: 'shadow-[0_0_0_4px_black,5px_5px_0px_2px_black]', translate: '-translate-y-5 md:-translate-y-7' },
				{ bg: 'bg-[#FFE4F0]', badge: 'bg-[#FF69B4]', icon: 'üéØ', textColor: 'text-[#FF69B4]', border: 'shadow-[0_0_0_3px_black,4px_4px_0px_2px_black]', translate: '' },
				{ bg: 'bg-[#E8E4FF]', badge: 'bg-[#6B46C1]', icon: 'üí°', textColor: 'text-[#6B46C1]', border: 'shadow-[0_0_0_3px_black,4px_4px_0px_2px_black]', translate: '' }
			];
			const config = podiumConfigs[position];
			
			return (
				<div class={`${config.bg} rounded-2xl sm:rounded-3xl p-6 sm:p-8 ${config.border} ${config.translate}`}>
					<div class="flex justify-center mb-4 sm:mb-6">
						<div class={`${config.badge} ${position === 0 ? 'w-16 h-16 sm:w-20 sm:h-20' : 'w-14 h-14 sm:w-16 sm:h-16'} rounded-full flex items-center justify-center shadow-[0_0_0_3px_black,3px_3px_0px_2px_black]`}>
							{position === 0 ? (
								<Trophy class="w-8 h-8 sm:w-10 sm:h-10 text-white" />
							) : (
								position === 1 ? (
									<p class="text-3xl sm:text-4xl text-white font-oi">2</p>
								) : (
									<p class="text-3xl sm:text-4xl text-white font-oi">3</p>
								)
							)}
						</div>
					</div>
					<h3 class="font-oi text-2xl sm:text-3xl text-black text-center mb-2 sm:mb-3">
						{equipe.equipe_nom}
					</h3>
					{equipe.description && (
						<p class="font-nohemi text-xs sm:text-sm text-gray-700 text-center mb-4 sm:mb-6">
							{equipe.description}
						</p>
					)}
					<div class="text-center mb-4 sm:mb-6">
						<p class={`font-oi text-2xl sm:text-3xl md:text-4xl ${config.textColor}`}>
							{equipe.points} PTS
						</p>
					</div>
					<div class="space-y-2 sm:space-y-3">
						{equipe.membres.map((membre: any) => (
							<div class="bg-white rounded-2xl px-3 sm:px-4 py-2 sm:py-2.5 text-center shadow-[0_0_0_3px_black,3px_3px_0px_2px_black]">
								<p class="font-nohemi text-xs sm:text-sm font-medium text-black">
									{membre.user_prenom} {membre.user_nom}
								</p>
							</div>
						))}
					</div>
				</div>
			);
		})}
			</div>
			
			<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-5 md:gap-6 w-full">
					<div class="bg-white rounded-2xl p-6 sm:p-8 text-center shadow-[0_0_0_2px_black,3px_3px_0px_1px_black]">
						<div class="flex justify-center mb-2 sm:mb-3">
							<Participant class="w-8 h-8 sm:w-10 sm:h-10" />
						</div>
						<p class="font-oi text-3xl sm:text-4xl text-black mb-1 sm:mb-2">{statsData[0]?.total_membres || 52}</p>
						<p class="font-nohemi text-sm sm:text-base text-gray-600">Participants</p>
					</div>
					<div class="bg-white rounded-2xl p-6 sm:p-8 text-center shadow-[0_0_0_2px_black,3px_3px_0px_1px_black]">
						<div class="flex justify-center mb-2 sm:mb-3">
							<Equipe class="w-8 h-8 sm:w-10 sm:h-10" />
						</div>
						<p class="font-oi text-3xl sm:text-4xl text-black mb-1 sm:mb-2">{statsData[0]?.total_equipes || 12}</p>
						<p class="font-nohemi text-sm sm:text-base text-gray-600">√âquipes</p>
					</div>
					<div class="bg-white rounded-2xl p-6 sm:p-8 text-center shadow-[0_0_0_2px_black,3px_3px_0px_1px_black]">
						<div class="flex justify-center mb-2 sm:mb-3">
							<Palette class="w-8 h-8 sm:w-10 sm:h-10" />
						</div>
					<p class="font-oi text-3xl sm:text-4xl text-black mb-1 sm:mb-2">{totalRendus}</p>
						<p class="font-nohemi text-sm sm:text-base text-gray-600">Rendus</p>
					</div>
				</div>
			</div>
		</div>

		<div class="w-8/10">
			<div class="bg-gradient-to-r from-[#FF6B6B] to-[#FF8E8E] rounded-2xl sm:rounded-3xl p-6 sm:p-10 md:p-14 text-center shadow-[0_0_0_3px_black,4px_4px_0px_2px_black] sm:shadow-[0_0_0_4px_black,6px_6px_0px_3px_black]">
				<div class="text-5xl sm:text-6xl mb-4 sm:mb-6">‚ù§Ô∏è</div>
				<h2 class="font-oi text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-white mb-4 sm:mb-6 uppercase">
					Merci √† tous ! üíú
				</h2>
				<p class="font-nohemi text-white text-base sm:text-lg md:text-xl lg:text-2xl leading-relaxed max-w-3xl mx-auto">
					Un immense merci √† tous les designers, mentors, sponsors et organisateurs qui ont rendu ce D√©fi24 inoubliable. Rendez-vous l'ann√©e prochaine pour encore plus de cr√©ativit√© ! üíú
				</p>
			</div>
		</div>
	</div>
</Layout>

<script>
	const userDataString = localStorage.getItem('user');

	if (userDataString) {
		try {
			const userData = JSON.parse(userDataString);
			if (userData.email) {
				const avatarImg = document.createElement("img");
				avatarImg.src = userData.avatar;
				avatarImg.alt = "Avatar";
				
				
				const inscriptionBtn = document.getElementById('inscriptionBtn') as HTMLAnchorElement;
				if (inscriptionBtn) {
					inscriptionBtn.href = 'https://my.weezevent.com/defi-24h-2026';
					inscriptionBtn.textContent = 'Billetterie';
					inscriptionBtn.target = '_blank';
					inscriptionBtn.rel = 'noopener noreferrer';
				}
			}
		} catch (error) {
			console.error('Erreur lors de la lecture des donn√©es utilisateur', error);
		}
	}
	
	var duree: number;

	function updateStatsCountdown() {
		const countdownEl = document.getElementById("countdown-stats");
		
		if (!countdownEl) return;

		if (duree < 0) {
			countdownEl.innerHTML = "00h";
			return;
		}

		let s = duree;
		let m = 0;
		let h = 0;

		if (s > 59) {
			m = Math.floor(s / 60);
			s = s - m * 60;
		}
		if (m > 59) {
			h = Math.floor(m / 60);
			m = m - h * 60;
		}

		countdownEl.innerHTML = h + "h";

		duree = duree - 1;
		window.setTimeout(updateStatsCountdown, 1000);
	}

	var dateDebut = new Date(2026, 0, 9, 18, 0, 0);
	var dateFin = new Date(2026, 0, 10, 18, 0, 0);
	var maintenant = new Date();

	duree = Math.floor((dateFin.getTime() - maintenant.getTime()) / 1000);

	updateStatsCountdown();
</script>