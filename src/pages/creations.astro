---
import Layout from "../layouts/Layout.astro"
import Icon from "../assets/Icon.svg"
import Ampoule from "../assets/ampoule.svg"
import Image from "../assets/image.svg"
import Stars from "../assets/stars.svg"
import Button from "../components/Button.astro"
---

<Layout
	title="Créations - Défi 24h MMI | Projets et réalisations"
	description="Découvrez toutes les créations réalisées lors du Défi 24h MMI. Explorez les projets innovants des équipes participantes et laissez-vous inspirer !"
	keywords="créations défi 24h, projets MMI, réalisations 24h, portfolio créatif, travaux étudiants MMI"
	canonical="/creations"
>
    <div class="flex flex-col mb-15 justify-center items-center mt-25 lg:mt-40 px-4">
        <h1
            class="text-white font-oi text-center text-3xl xs:text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl leading-tight tracking-wide">
            Les talents à découvrir
        </h1>
    </div>
    <div class="flex flex-col items-center space-y-10">
        <div
            class="space-y-6 bg-white/80 w-8/10 px-6 sm:px-8 md:px-10 py-7 md:py-10 rounded-2xl font-nohemi shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] sm:shadow-[0_0_0_3px_black,4px_4px_0px_2px_black]">
            <h2 class="text-2xl sm:text-3xl font-black text-center">Soumettre votre projet</h2>
            <p class="text-center text-[#717182]">Partagez votre création avec la communauté !</p>
            
            <form id="creationForm" class="space-y-6">
                <div class="space-y-2">
                    <label for="nom" class="block font-bold text-lg">Nom du projet <span class="text-red-500">*</span></label>
                    <input 
                        type="text" 
                        id="nom" 
                        name="nom" 
                        required
                        placeholder="Ex: Mon projet innovant"
                        class="w-full px-4 py-3 rounded-lg border-2 border-black font-nohemi focus:outline-none focus:ring-2 focus:ring-primary"
                    />
                </div>

                <div class="space-y-2">
                    <label for="lien" class="block font-bold text-lg">Lien de redirection <span class="text-red-500">*</span></label>
                    <input 
                        type="url" 
                        id="lien" 
                        name="lien" 
                        required
                        placeholder="https://exemple.com/mon-projet"
                        class="w-full px-4 py-3 rounded-lg border-2 border-black font-nohemi focus:outline-none focus:ring-2 focus:ring-primary"
                    />
                </div>

                <div id="messageContainer" class="hidden">
                    <div id="messageContent" class="p-4 rounded-lg text-center font-bold"></div>
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-primary text-white font-bold py-4 px-6 rounded-lg shadow-[0_0_0_2px_black,3px_3px_0px_1px_black] hover:translate-y-[-2px] transition-transform">
                    Soumettre mon projet
                </button>
            </form>
        </div>
    </div>
</Layout>

<script>
    const userDataString = localStorage.getItem('user');

    const form = document.getElementById('creationForm') as HTMLFormElement;
    const messageContainer = document.getElementById('messageContainer') as HTMLDivElement;
    const messageContent = document.getElementById('messageContent') as HTMLDivElement;

    form?.addEventListener('submit', async (e) => {
        e.preventDefault();

        const userData = JSON.parse(userDataString);
        const formData = new FormData(form);
        formData.append('userId', userData.id);

        try {
            const response = await fetch('/api/create-creation', {
                method: 'POST',
                body: formData,
            });

            const data = await response.json();

            if (response.ok) {
                messageContainer.classList.remove('hidden');
                messageContent.textContent = data.message;
                messageContent.className = 'p-4 rounded-lg text-center font-bold bg-green-100 text-green-800 border-2 border-green-500';
                form.reset();
                
                setTimeout(() => {
                    messageContainer.classList.add('hidden');
                }, 5000);
            } else {
                messageContainer.classList.remove('hidden');
                messageContent.textContent = data.error;
                messageContent.className = 'p-4 rounded-lg text-center font-bold bg-red-100 text-red-800 border-2 border-red-500';
            }
        } catch (error) {
            messageContainer.classList.remove('hidden');
            messageContent.textContent = 'Erreur de connexion au serveur.';
            messageContent.className = 'p-4 rounded-lg text-center font-bold bg-red-100 text-red-800 border-2 border-red-500';
        }
    });
</script>